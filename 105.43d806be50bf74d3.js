"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[105],{2105:(Y,m,r)=>{r.r(m),r.d(m,{LoginModule:()=>J});var c=r(6814),u=r(7586),d=r(5861),s=r(6223),o=r(8926),x=r(3859),b=r(6772),S=r(2147),y=r(9865),C=r(8516),h=r(707),p=r(3714),f=r(7853),U=r(4104);function w(t,g){1&t&&(o.TgZ(0,"div",2)(1,"h2"),o._uU(2,"Ya has iniciado sesi\xf3n"),o.qZA()())}function L(t,g){1&t&&(o.TgZ(0,"small",21),o._uU(1," Usuario es obligatorio "),o.qZA())}function Z(t,g){1&t&&(o.TgZ(0,"small",21),o._uU(1," Contrase\xf1a es obligatorio "),o.qZA())}const v=function(t){return{"ng-invalid ng-dirty":t}};function k(t,g){if(1&t){const e=o.EpF();o.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"div",8),o._uU(6,"SGPH"),o.qZA(),o.TgZ(7,"span",9),o._uU(8,"Iniciar sesi\xf3n para continuar"),o.qZA()(),o.TgZ(9,"form",10)(10,"div",11)(11,"label",12),o._uU(12,"Usuario"),o.qZA(),o._UZ(13,"input",13),o.YNc(14,L,2,0,"small",14),o.qZA(),o.TgZ(15,"div",11)(16,"label",15),o._uU(17,"Contrase\xf1a"),o.qZA(),o._UZ(18,"p-password",16),o.YNc(19,Z,2,0,"small",14),o.qZA(),o.TgZ(20,"button",17),o.NdJ("click",function(){o.CHM(e);const n=o.oxw();return o.KtG(n.iniciarSesionNormal())}),o.qZA()(),o._UZ(21,"hr"),o.TgZ(22,"div",18)(23,"button",19),o.NdJ("click",function(){o.CHM(e);const n=o.oxw();return o.KtG(n.iniciarSesionGoogle())}),o._UZ(24,"img",20),o.qZA()()()()()()}if(2&t){const e=o.oxw();o.xp6(9),o.Q6J("formGroup",e.formulario),o.xp6(4),o.Q6J("ngClass",o.VKq(7,v,e.nombreUsuario().invalid&&e.nombreUsuario().touched)),o.xp6(1),o.Q6J("ngIf",e.nombreUsuario().invalid&&e.nombreUsuario().touched),o.xp6(4),o.Q6J("toggleMask",!0)("feedback",!1)("ngClass",o.VKq(9,v,e.password().invalid&&e.password().touched)),o.xp6(1),o.Q6J("ngIf",e.password().invalid&&e.password().touched)}}let T=(()=>{class t{constructor(e,i,n,l,a,N,G){this.layoutService=e,this.fb=i,this.loginService=n,this.tokenService=l,this.router=a,this.oauthService=N,this.showMessageService=G,this.isLogged=!1,this.isLoginFail=!1,this.roles=[],this.valCheck=["remember"],this.initLogin()}initLogin(){const e={issuer:"https://accounts.google.com",strictDiscoveryDocumentValidation:!1,clientId:"209217537458-cmls25384a06iif0mca643mpqrebig26.apps.googleusercontent.com",redirectUri:window.location.origin+"/auth/login",scope:"openid profile email"};this.oauthService.configure(e),this.oauthService.setupAutomaticSilentRefresh(),this.oauthService.loadDiscoveryDocumentAndTryLogin(),this.oauthService.events.subscribe(i=>{console.log(i),"token_received"===i.type&&this.loginGoogle()})}loginGoogle(){var e=this;return(0,d.Z)(function*(){try{const i=e.oauthService.getIdToken();JSON.parse(atob(i.split(".")[1]));let a=yield e.loginService.loginGoogle(e.oauthService.getAccessToken()).toPromise();null==a?(console.error("Error durante el flujo de login",a),e.showMessageService.showMessage("error","Usuario no registrado")):(e.establercerInfoLocalStorage(a),e.router.navigate(["/"]))}catch(i){e.oauthService.logOut(),console.error("Error al intentar iniciar sesi\xf3n con Google:",i),e.showMessageService.showMessage("error","Usuario no registrado")}})()}iniciarSesionGoogle(){var e=this;return(0,d.Z)(function*(){try{yield e.oauthService.initLoginFlow()}catch(i){console.error("Error durante el flujo de login",i)}})()}ngOnInit(){this.inicializarFormulario(),this.tokenService.getToken()&&(this.isLogged=!0,this.isLoginFail=!1,this.roles=this.tokenService.getAuthorities())}inicializarFormulario(){this.formulario=this.fb.group({nombreUsuario:["",s.kI.required],password:[null,s.kI.required]})}nombreUsuario(){return this.formulario.get("nombreUsuario")}password(){return this.formulario.get("password")}iniciarSesionNormal(){this.formulario.invalid?this.formulario.markAllAsTouched():this.loginService.login(this.nombreUsuario().value,this.password().value).subscribe(e=>{this.isLogged=!0,this.establercerInfoLocalStorage(e),this.router.navigate(["/"])},e=>{this.isLogged=!1,this.showMessageService.showMessage("error","Nombre de usuario o contrase\xf1a err\xf3neos")})}establercerInfoLocalStorage(e){this.tokenService.setToken(e.token),this.tokenService.setUserName(e.nombreUsuario),this.tokenService.setAuthorities(e.authorities),this.roles=e.authorities,this.showMessageService.showMessage("error","Bienvenido "+e.nombreUsuario)}static#o=this.\u0275fac=function(i){return new(i||t)(o.Y36(x.P),o.Y36(s.qu),o.Y36(b.r),o.Y36(S.B),o.Y36(u.F0),o.Y36(y.Ct),o.Y36(C.M))};static#e=this.\u0275cmp=o.Xpm({type:t,selectors:[["app-login"]],decls:4,vars:2,consts:[["class","text-center",4,"ngIf","ngIfElse"],["loggedOut",""],[1,"text-center"],[1,"surface-ground","flex","align-items-center","justify-content-center","min-h-screen","min-w-screen","overflow-hidden"],[1,"flex","flex-column","align-items-center","justify-content-center"],[2,"border-radius","56px","padding","0.3rem","background","linear-gradient(180deg, var(--primary-color) 10%, rgba(33, 150, 243, 0) 30%)","width","500px"],[1,"w-full","surface-card","py-8","px-5","sm:px-8",2,"border-radius","53px"],[1,"text-center","mb-5"],[1,"text-900","text-3xl","font-medium","mb-3"],[1,"text-600","font-medium"],[3,"formGroup"],[1,"p-fluid","col","sm:col-12"],["for","email1",1,"block","text-900","text-xl","font-medium","mb-2"],["id","email1","type","text","placeholder","Nombre de usuario","pInputText","","formControlName","nombreUsuario",1,"w-full","mb-2",2,"padding","1rem",3,"ngClass"],["class","p-error block fade-in",4,"ngIf"],["for","password1",1,"block","text-900","font-medium","text-xl","mb-2"],["id","password1","placeholder","Contrase\xf1a","styleClass","w-full mb-2","inputStyleClass","w-full","formControlName","password",3,"toggleMask","feedback","ngClass"],["pButton","","pRipple","","label","Continuar",1,"w-full","p-3","text-xl",3,"click"],[1,"row"],["pButton","","pRipple","","label","Continuar con Google",1,"w-full","p-3","text-xl",2,"background-color","white","color","black",3,"click"],["src","https://img.icons8.com/color/22/000000/google-logo.png","alt","Google Logo",1,"btn-icon"],[1,"p-error","block","fade-in"]],template:function(i,n){if(1&i&&(o._UZ(0,"p-toast"),o.YNc(1,w,3,0,"div",0),o.YNc(2,k,25,11,"ng-template",null,1,o.W1O)),2&i){const l=o.MAs(3);o.xp6(1),o.Q6J("ngIf",n.isLogged)("ngIfElse",l)}},dependencies:[c.mk,c.O5,h.Hq,p.o,s._Y,s.Fj,s.JJ,s.JL,f.ro,s.sg,s.u,U.FN],styles:["[_nghost-%COMP%]     .pi-eye, [_nghost-%COMP%]     .pi-eye-slash{transform:scale(1.6);margin-right:1rem;color:var(--primary-color)!important}"]})}return t})(),A=(()=>{class t{static#o=this.\u0275fac=function(i){return new(i||t)};static#e=this.\u0275mod=o.oAB({type:t});static#t=this.\u0275inj=o.cJS({imports:[u.Bz.forChild([{path:"",component:T}]),u.Bz]})}return t})();var M=r(8057),F=r(5219),I=r(1702);let J=(()=>{class t{static#o=this.\u0275fac=function(i){return new(i||t)};static#e=this.\u0275mod=o.oAB({type:t});static#t=this.\u0275inj=o.cJS({imports:[c.ez,A,h.hJ,M.nD,p.j,s.u5,f.gz,F.m8,s.UX,I.g]})}return t})()}}]);